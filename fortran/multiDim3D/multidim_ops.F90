!
! auto-generated by ops_fortran.py
!


















program MULTIDIM
  use OPS_Fortran_Declarations
  use OPS_Fortran_RT_Support
  use MULTIDIM_KERNEL_MODULE
  use MULTIDIM_COPY_KERNEL_MODULE
  use MULTIDIM_PRINT_KERNEL_MODULE
  use MULTIDIM_REDUCE_KERNEL_MODULE
  use OPS_CONSTANTS






  use, intrinsic :: ISO_C_BINDING

  implicit none

  intrinsic :: sqrt, real

  integer x_cells /4/
  integer y_cells /4/
  integer z_cells /4/

  type(ops_block)   :: grid3D

  type(ops_dat)     :: dat0, dat1

  integer s3D_00_arry(3) /0,0,0/
  type(ops_stencil) :: S3D_00

  real(8), dimension(3) :: reduct_result
  type(ops_reduction) :: reduct_dat1

  real(8):: qa_diff

  integer d_p(3) /1,1,1/
  integer d_m(3) /-1,-1,-1/

  integer size(3) /4,4,4/

  integer base1(3) /1,1,1/
  integer base2(3) /1,1,1/


  real(8), dimension(:), allocatable :: temp

  real(kind=c_double) :: startTime = 0
  real(kind=c_double) :: endTime = 0




  integer iter_range(6) /1,4,1,4,1,4/
  integer iter_range2(6) /4,4,1,4,1,4/



  call ops_init(2)


  call ops_decl_block(3, grid3D, "grid3D")

  call ops_decl_stencil( 3, 1, s3D_00_arry, S3D_00, "000");


  call ops_decl_dat(grid3D, 3, size, base1, d_m, d_p, temp,  dat0, "real(8)", "dat0")
  call ops_decl_dat(grid3D, 3, size, base2, d_m, d_p, temp,  dat1, "real(8)", "dat1")

  const1 = 5.44_8
  reduct_result(1) = 0.0_8
  reduct_result(2) = 0.0_8
  reduct_result(3) = 0.0_8
  call ops_decl_reduction_handle(24, reduct_dat1, "real(8)", "reduct_dat1");

  call ops_partition("3D_BLOCK_DECOMPSE")
  call ops_diagnostic_output()

  call ops_timers ( startTime )

  call multidim_kernel_host("multidim_kernel", grid3D, 3, iter_range, &
                    & ops_arg_dat(dat0, 3, S3D_00, "real(8)", OPS_WRITE), &
                    & ops_arg_idx())

  call multidim_copy_kernel_host("multidim_copy_kernel", grid3D, 3, iter_range, &
                    & ops_arg_dat(dat0, 3, S3D_00, "real(8)", OPS_READ), &
                    & ops_arg_dat(dat1, 3, S3D_00, "real(8)", OPS_WRITE))

  call multidim_print_kernel_host("multidim_print_kernel", grid3D, 3, iter_range, &
                    & ops_arg_dat(dat0, 3, S3D_00, "real(8)", OPS_READ))

  call multidim_reduce_kernel_host("multidim_reduce_kernel", grid3D, 3, iter_range, &
                    & ops_arg_dat(dat1, 3, S3D_00, "real(8)", OPS_READ), &
                    & ops_arg_reduce(reduct_dat1, 3, "real(8)", OPS_INC))

  call ops_reduction_result(reduct_dat1, reduct_result)

  call ops_timers ( endTime )

  call ops_print_dat_to_txtfile(dat0, "multidim.dat")

  if (ops_is_root() .eq. 1) then
    write (*,'(a,f16.7,a)') 'Max total runtime =', endTime - startTime,' seconds'

    qa_diff=ABS((100.0_8*((reduct_result(1)+reduct_result(2)+reduct_result(3))/(3*160.00000_8)))-100.0_8)
    write(*,'(a,f16.7,f16.7,f16.7)') "Reduction result = ", reduct_result
    write(*,'(a,e16.7,a)') "Reduction result is within ",qa_diff,"% of the expected result"

    IF(qa_diff.LT.0.0000000000001) THEN
      write(*,'(a)')"This test is considered PASSED"
    ELSE
      write(*,'(a)')"This test is considered FAILED"
    ENDIF
  end if

  call ops_exit( )

end program MULTIDIM
