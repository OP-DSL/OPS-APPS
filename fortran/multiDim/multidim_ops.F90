!
! auto-generated by ops_fortran.py
!


















program MULTIDIM
  use OPS_Fortran_Declarations
  use OPS_Fortran_RT_Support
  use MULTIDIM_KERNEL_MODULE
  use MULTIDIM_COPY_KERNEL_MODULE
  use MULTIDIM_PRINT_KERNEL_MODULE
  use MULTIDIM_REDUCE_KERNEL_MODULE
  use OPS_CONSTANTS






  use, intrinsic :: ISO_C_BINDING

  implicit none

  intrinsic :: sqrt, real

  integer x_cells /4/
  integer y_cells /4/

  type(ops_block)   :: grid2D

  type(ops_dat)     :: dat0, dat1

  integer s2D_00_arry(2) /0,0/
  type(ops_stencil) :: S2D_00

  real(8), dimension(2) :: reduct_result
  type(ops_reduction) :: reduct_dat1

  integer d_p(2) /1,1/
  integer d_m(2) /-1,-1/

  integer size(2) /4,4/

  integer base1(2) /1,1/
  integer base2(2) /1,1/


  real(8), dimension(:), allocatable :: temp

  real(kind=c_double) :: startTime = 0
  real(kind=c_double) :: endTime = 0




  integer iter_range(4) /1,4,1,4/

  REAL(KIND=8) :: qa_diff


  call ops_init(2)


  call ops_decl_block(2, grid2D, "grid2D")

  call ops_decl_stencil( 2, 1, s2D_00_arry, S2D_00, "00");


  call ops_decl_dat(grid2D, 2, size, base1, d_m, d_p, temp,  dat0, "real(8)", "dat0")
  call ops_decl_dat(grid2D, 2, size, base2, d_m, d_p, temp,  dat1, "real(8)", "dat1")

  const1 = 5.44_8
  reduct_result(1) = 0.0_8
  reduct_result(2) = 0.0_8
  call ops_decl_reduction_handle(16, reduct_dat1, "real(8)", "reduct_dat1");

  call ops_partition("2D_BLOCK_DECOMPSE")
  call ops_diagnostic_output()

  call ops_timers ( startTime )

  call multidim_kernel_host("multidim_kernel", grid2D, 2, iter_range, &
                    & ops_arg_dat(dat0, 2, S2D_00, "real(8)", OPS_WRITE), &
                    & ops_arg_idx())

  call multidim_copy_kernel_host("multidim_copy_kernel", grid2D, 2, iter_range, &
                    & ops_arg_dat(dat0, 2, S2D_00, "real(8)", OPS_READ), &
                    & ops_arg_dat(dat1, 2, S2D_00, "real(8)", OPS_WRITE))

  call multidim_print_kernel_host("multidim_print_kernel", grid2D, 2, iter_range, &
                    & ops_arg_dat(dat0, 2, S2D_00, "real(8)", OPS_READ))

  call multidim_reduce_kernel_host("multidim_reduce_kernel", grid2D, 2, iter_range, &
                    & ops_arg_dat(dat1, 2, S2D_00, "real(8)", OPS_READ), &
                    & ops_arg_reduce(reduct_dat1, 2, "real(8)", OPS_INC))

  call ops_reduction_result(reduct_dat1, reduct_result)

  call ops_timers ( endTime )

  call ops_print_dat_to_txtfile(dat0, "multidim.dat")

  if (ops_is_root() .eq. 1) then

    write (*,'(a,f16.7,a)') 'Max total runtime =', endTime - startTime,' seconds'

    qa_diff=ABS((100.0_8*((reduct_result(1)+reduct_result(2))/(2*40.00000_8)))-100.0_8)
    write(*,'(a,f16.7,f16.7)') "Reduction result = ", reduct_result
    write(*,'(a,e16.7,a)') "Reduction result is within ",qa_diff,"% of the expected result"

    IF(qa_diff.LT.0.0000000000001) THEN
      write(*,'(a)')"This test is considered PASSED"
    ELSE
      write(*,'(a)')"This test is considered FAILED"
    ENDIF

  end if

  call ops_exit( )

end program MULTIDIM
